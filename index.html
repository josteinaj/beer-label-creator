<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8"/>
<title>Beer labels</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.2/normalize.min.css" media="all" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" />
<link href='http://fonts.googleapis.com/css?family=Fjord+One' rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css' />

<style>
    .beer-label {
        height: 66mm;
        border-style: solid;
        border-width: 1px;
        border-color: lightGray;
        display: table-cell;
        background-size: cover;
        text-align: right;
        position: relative;
    }
    .beer-table {
        display: table;
        width: 100%;
    }
    .inner-beer-table {
        display: table;
        width: 100%;
        position: relative;
        z-index: 2;
    }
    .beer-row {
        display: table-row;
    }
    .beer-label-cell {
        padding: 0mm;
        height: 66mm;
        display: table-cell;
        margin: auto;
    }
    .beer-label-title-wrapper {
        width: 100%;
        text-align: center;
        vertical-align: middle;
    }
    .beer-label-text-wrapper {
        background-color: rgba(255, 255, 255, 0.9);
        width: 1%;
        height: 56mm;
        /*spacing: 1mm;*/
    }
    .beer-label-title {
        background-color: rgba(255, 255, 255, 0.5);
        font-family: 'Fjord One', serif;
        font-size: 2em;
        margin: 0;
        padding: 0;
        spacing: 0;
    }
    .beer-label-subtitle {
        background-color: rgba(255, 255, 255, 0.5);
        font-family: 'Fjord One', serif;
        font-size: 1.2em;
        margin: 0;
        padding: 0;
        spacing: 0;
    }
    .beer-label-text {
        font-family: 'Fjord One', serif;
        text-align: left;
    }
    .beer-label-image {
        position: absolute;
        z-index: -1;
        left: 0;
        top: 0;
        height: 66mm;
    }
    @media print {
      @page {
        size: 210mm 297mm;
        margin: 5mm;
      }
      .hidden-print {
        display: none;
      }
    }
    @media screen {
        .hidden-screen {
            display: none;
        }
        .beer-label {
            display: table-cell;
            width: 94mm;
            height: 66mm;
        }
        pre {
            padding: 0px;
            font-size: 13px;
            color: black;
            background-color: transparent;
            border: 0px;
        }
    }
</style>
</head>
<body>
    
    <div class="hidden-print container">
        <h1 class="hidden-print">Beer label creator</h1>
        <p>Print this page to get a A4 page of 8 labels.</p>
        <br/>
        <form name="label-form" class="form-horizontal">
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">Title:</label>
                <div class="col-sm-10">
                    <input type="text" name="title" id="title" placeholder="Name of beer (example: 'Donut Stout')" style="width:100%;"/>
                </div>
            </div>
            <div class="form-group">
                <label for="subtitle" class="col-sm-2 control-label">Subtitle:</label>
                <div class="col-sm-10">
                    <input type="text" name="subtitle" id="subtitle" placeholder="Small text under beer name (example: '6,3 %')" style="width:100%;"/>
                </div>
            </div>
            <div class="form-group">
                <label for="hue" class="col-sm-2 control-label">Title font:</label>
                <div class="col-sm-10">
                    <select name="font" id="font" style="width:100%;">
                        <option selected="">'Fjord One', serif</option>
                        <option>"Open Sans", sans-serif</option>
                        <option>"Lobster", sans-serif</option>
                        <option>"Droid Sans", sans-serif</option>
                        <option>"PT Sans", sans-serif</option>
                        <option>"Lato", sans-serif</option>
                        <option>Georgia, serif</option>
                        <option>"Palatino Linotype", "Book Antiqua", Palatino, serif</option>
                        <option>"Times New Roman", Times, serif</option>
                        <option>Arial, Helvetica, sans-serif</option>
                        <option>"Arial Black", Gadget, sans-serif</option>
                        <option>"Comic Sans MS", cursive, sans-serif</option>
                        <option>Impact, Charcoal, sans-serif</option>
                        <option>"Lucida Sans Unicode", "Lucida Grande", sans-serif</option>
                        <option>Tahoma, Geneva, sans-serif</option>
                        <option>"Trebuchet MS", Helvetica, sans-serif</option>
                        <option>Verdana, Geneva, sans-serif</option>
                        <option>"Courier New", Courier, monospace</option>
                        <option>"Lucida Console", Monaco, monospace</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="hue" class="col-sm-2 control-label">Title color:</label>
                <div class="col-sm-10">
                    <input type="number" min="0" max="360" value="0" step="1" name="hue" id="hue" style="width:100px;"/>
                    <input type="number" min="0" max="100" value="100" step="1" name="saturation" id="saturation" style="width:100px;"/>
                    <input type="number" min="0" max="100" value="0" step="1" name="lighting" id="lighting" style="width:100px;"/>
                    <br/>
                    <p>Hue (0-360), Saturation (0%-100%), Brightness (0%-100%)</p>
                </div>
            </div>
            <div class="form-group">
                <label for="titlebgalpha" class="col-sm-2 control-label">Title background transparency (0.0-1.0):</label>
                <div class="col-sm-10">
                    <input type="number" min="0.0" max="1.0" value="0.5" step="0.05" name="titlebgalpha" id="titlebgalpha" style="width:100px;"/>
                </div>
            </div>
            <div class="form-group">
                <label for="image" class="col-sm-2 control-label">Image URL:</label>
                <div class="col-sm-10">
                    <input type="url" name="image" id="image" value="example-label.png" style="width:100%;"/>
                </div>
            </div>
            <div class="form-group">
                <label for="text" class="col-sm-2 control-label">Description:</label>
                <div class="col-sm-10">
                    <textarea name="text" id="text" rows="9" cols="30" placeholder="Brewed by / batch number / date / etc."></textarea>
                </div>
            </div>
        </form>
        
        <br/>
        
        <div style="width: 100%; text-align: center;">
            <div style="display: inline-block;">
                <div class="beer-label">
                    <img src="example-label.png" class="beer-label-image"/>
                    <div class="beer-label-cell beer-label-title-wrapper">
                        <p class="beer-label-title"></p>
                        <p class="beer-label-subtitle"></p>
                    </div>
                    <div class="beer-label-cell beer-label-text-wrapper">
                        <pre class="beer-label-text"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="beer-table hidden-screen">
        
        <div class="beer-row">
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
        </div>

        <div class="beer-row">
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
        </div>

        <div class="beer-row">
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
        </div>

        <div class="beer-row">
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
            <div class="beer-label">
                <img src="example-label.png" class="beer-label-image"/>
                <div class="beer-label-cell beer-label-title-wrapper">
                    <p class="beer-label-title"></p>
                    <p class="beer-label-subtitle"></p>
                </div>
                <div class="beer-label-cell beer-label-text-wrapper">
                    <pre class="beer-label-text"></pre>
                </div>
            </div>
        </div>

    </div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-60210147-1', 'auto');
      ga('send', 'pageview');
    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="http://www.parsecdn.com/js/parse-1.4.0.min.js"></script>
    <script>
        setInterval(
            function() {
                var text, elements, i, hue, saturation, lighting, color, titleBgTransparency;
                
                // Yeah yeah, this should've all been implemented using event listeners etc. Just doing it quick and dirty for now.
                
                text = document.getElementById("text").value;
                elements = document.querySelectorAll(".beer-label-text");
                for (i = 0; i < elements.length; i++) {
                    elements[i].innerHTML = text;
                }
                elements = document.querySelectorAll(".beer-label-text-wrapper");
                for (i = 0; i < elements.length; i++) {
                    if (text === "") {
                        elements[i].style.visibility = "hidden";
                        elements[i].style.padding = "0mm";
                    } else {
                        elements[i].style.visibility = "visible";
                        elements[i].style.padding = "5mm";
                    }
                }
                elements = document.querySelectorAll(".beer-label-title-wrapper");
                for (i = 0; i < elements.length; i++) {
                    if (text === "") {
                        elements[i].style.width = "100%";
                    } else {
                        elements[i].style.width = "70%";
                    }
                }
                
                hue = document.getElementById("hue").value;
                saturation = document.getElementById("saturation").value;
                lighting = document.getElementById("lighting").value;
                color = "hsl("+hue+", "+saturation+"%, "+lighting+"%)";
                titleBgTransparency = "rgba(255, 255, 255, "+document.getElementById("titlebgalpha").value+")";
                
                text = document.getElementById("title").value;
                elements = document.querySelectorAll(".beer-label-title");
                for (i = 0; i < elements.length; i++) {
                    elements[i].innerHTML = text;
                    elements[i].style.color = color;
                    elements[i].style.backgroundColor = titleBgTransparency;
                }
                
                text = document.getElementById("subtitle").value;
                elements = document.querySelectorAll(".beer-label-subtitle");
                for (i = 0; i < elements.length; i++) {
                    elements[i].innerHTML = text;
                    elements[i].style.color = color;
                    elements[i].style.backgroundColor = titleBgTransparency;
                }
                
                text = document.getElementById("image").value;
                elements = document.querySelectorAll(".beer-label-image");
                for (i = 0; i < elements.length; i++) {
                    elements[i].src = text;
                }
                
                text = document.getElementById("font").value;
                elements = document.querySelectorAll(".beer-label-title, .beer-label-subtitle");
                for (i = 0; i < elements.length; i++) {
                    elements[i].style.fontFamily = text;
                }
            },
            250
        );
        
        
        setTimeout(
            function(){
                document.getElementsByClassName('beer-label-image')[0].setAttribute("data-image-resolves", true);
                document.getElementsByClassName('beer-label-image')[0].onerror = function() {
                    document.getElementsByClassName('beer-label-image')[0].setAttribute("data-image-resolves", false);
                };
                document.getElementsByClassName('beer-label-image')[0].onload = function() {
                    document.getElementsByClassName('beer-label-image')[0].setAttribute("data-image-resolves", true);
                };
                
                Parse.initialize("F3m7tsueH3ERAeQddv2PC9CzDH38CVOfyhHSum2E", "W5wMV0gQPOv32RVY9n9ne767jx46jykpsNjRR5Hf");
                var Label = Parse.Object.extend("Label");
                var label = new Label();
                
                setInterval(
                    function() {
                        var formElements, fe, data;
                        data = {};
                        formElements = document.forms['label-form'].elements;
                        for (fe = 0; fe < formElements.length; fe++) {
                            data[formElements[fe].name] = formElements[fe].value;
                        }
                        console.log(data);
                        if (   document.getElementsByClassName('beer-label-image')[0].getAttribute("data-image-resolves") === "true"
                            && (data['image'] !== "example-label.png" || data['title'] !== "" || data['text'] !== "")
                            ) {
                            label.save(data).then(function(object) {
                                console.log("saved data.");
                            });
                        } else {
                            console.log("not enough data to store; not storing");
                        }
                    },
                    3000
                );
            },
            0
        );
    </script>
</body>
</html>